<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>XSS | Vincent Hy Blog</title>
    <meta name="description" content="Vincent Hy Web World">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    
    <link rel="preload" href="/assets/css/0.styles.631a11f4.css" as="style"><link rel="preload" href="/assets/js/app.0e27453d.js" as="script"><link rel="preload" href="/assets/js/3.2e4f50e3.js" as="script"><link rel="preload" href="/assets/js/5.fd216eaf.js" as="script"><link rel="preload" href="/assets/js/33.1a15a89b.js" as="script"><link rel="prefetch" href="/assets/js/10.dbe7221e.js"><link rel="prefetch" href="/assets/js/11.bef9bcfe.js"><link rel="prefetch" href="/assets/js/12.aeaf7f20.js"><link rel="prefetch" href="/assets/js/13.139de979.js"><link rel="prefetch" href="/assets/js/14.d4acf505.js"><link rel="prefetch" href="/assets/js/15.402f4dd6.js"><link rel="prefetch" href="/assets/js/16.867022fb.js"><link rel="prefetch" href="/assets/js/17.979071ce.js"><link rel="prefetch" href="/assets/js/18.94365f15.js"><link rel="prefetch" href="/assets/js/19.1bfbc423.js"><link rel="prefetch" href="/assets/js/2.a18e5a75.js"><link rel="prefetch" href="/assets/js/20.f01ff6e3.js"><link rel="prefetch" href="/assets/js/21.b02aadb8.js"><link rel="prefetch" href="/assets/js/22.04c0f183.js"><link rel="prefetch" href="/assets/js/23.5144adae.js"><link rel="prefetch" href="/assets/js/24.ad1d9a77.js"><link rel="prefetch" href="/assets/js/25.436f6e78.js"><link rel="prefetch" href="/assets/js/26.e33cff2b.js"><link rel="prefetch" href="/assets/js/27.c253cd07.js"><link rel="prefetch" href="/assets/js/28.3f529c7a.js"><link rel="prefetch" href="/assets/js/29.1f39be6a.js"><link rel="prefetch" href="/assets/js/30.e5afa5b7.js"><link rel="prefetch" href="/assets/js/31.e6f68b4a.js"><link rel="prefetch" href="/assets/js/32.44645775.js"><link rel="prefetch" href="/assets/js/34.0cf3dc8c.js"><link rel="prefetch" href="/assets/js/35.5ea8712c.js"><link rel="prefetch" href="/assets/js/36.e4911807.js"><link rel="prefetch" href="/assets/js/37.ffa6c7ae.js"><link rel="prefetch" href="/assets/js/38.dd03957a.js"><link rel="prefetch" href="/assets/js/39.b2324b86.js"><link rel="prefetch" href="/assets/js/4.37063a31.js"><link rel="prefetch" href="/assets/js/40.d633e40a.js"><link rel="prefetch" href="/assets/js/41.9b4c5e14.js"><link rel="prefetch" href="/assets/js/42.c0f1a8d3.js"><link rel="prefetch" href="/assets/js/43.6bfb8345.js"><link rel="prefetch" href="/assets/js/44.3faf6bad.js"><link rel="prefetch" href="/assets/js/45.7f38cf88.js"><link rel="prefetch" href="/assets/js/46.314783af.js"><link rel="prefetch" href="/assets/js/47.efd175e9.js"><link rel="prefetch" href="/assets/js/48.9d2845a5.js"><link rel="prefetch" href="/assets/js/49.288bc37b.js"><link rel="prefetch" href="/assets/js/50.484934db.js"><link rel="prefetch" href="/assets/js/51.5f978030.js"><link rel="prefetch" href="/assets/js/52.0f0debbc.js"><link rel="prefetch" href="/assets/js/53.16fa6cc9.js"><link rel="prefetch" href="/assets/js/54.c0309608.js"><link rel="prefetch" href="/assets/js/55.17a5f3b2.js"><link rel="prefetch" href="/assets/js/56.54554b66.js"><link rel="prefetch" href="/assets/js/57.e1b5bfdc.js"><link rel="prefetch" href="/assets/js/58.732fd521.js"><link rel="prefetch" href="/assets/js/59.f10e5a7e.js"><link rel="prefetch" href="/assets/js/6.a74f7f08.js"><link rel="prefetch" href="/assets/js/60.6772c16b.js"><link rel="prefetch" href="/assets/js/61.ae645f8e.js"><link rel="prefetch" href="/assets/js/62.3ef7963e.js"><link rel="prefetch" href="/assets/js/63.8eb2911e.js"><link rel="prefetch" href="/assets/js/64.38814474.js"><link rel="prefetch" href="/assets/js/65.5d273167.js"><link rel="prefetch" href="/assets/js/66.6a788177.js"><link rel="prefetch" href="/assets/js/67.d73698d8.js"><link rel="prefetch" href="/assets/js/68.2742cf5a.js"><link rel="prefetch" href="/assets/js/69.9f4ca1d5.js"><link rel="prefetch" href="/assets/js/7.47b79638.js"><link rel="prefetch" href="/assets/js/70.497bf0e5.js"><link rel="prefetch" href="/assets/js/71.5c955e11.js"><link rel="prefetch" href="/assets/js/72.7bdd5e94.js"><link rel="prefetch" href="/assets/js/73.1366ff95.js"><link rel="prefetch" href="/assets/js/74.f6559362.js"><link rel="prefetch" href="/assets/js/75.9770f845.js"><link rel="prefetch" href="/assets/js/76.600674c7.js"><link rel="prefetch" href="/assets/js/77.85a3ba5c.js"><link rel="prefetch" href="/assets/js/78.ae9c5c80.js"><link rel="prefetch" href="/assets/js/79.9fefea19.js"><link rel="prefetch" href="/assets/js/8.dc45a39e.js"><link rel="prefetch" href="/assets/js/80.bbf61f29.js"><link rel="prefetch" href="/assets/js/81.ad905a97.js"><link rel="prefetch" href="/assets/js/82.24ea6352.js"><link rel="prefetch" href="/assets/js/83.b610df70.js"><link rel="prefetch" href="/assets/js/84.14a4bc86.js"><link rel="prefetch" href="/assets/js/85.134ea3a1.js"><link rel="prefetch" href="/assets/js/86.e9b3a7de.js"><link rel="prefetch" href="/assets/js/87.fdc46d1d.js"><link rel="prefetch" href="/assets/js/88.e2af9e67.js"><link rel="prefetch" href="/assets/js/89.64c5e02e.js"><link rel="prefetch" href="/assets/js/9.33bbeafc.js"><link rel="prefetch" href="/assets/js/90.d3da371b.js"><link rel="prefetch" href="/assets/js/91.76ec1373.js">
    <link rel="stylesheet" href="/assets/css/0.styles.631a11f4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="loader-wrapper" data-v-85f2f14c><div class="loader-main" data-v-85f2f14c><div data-v-85f2f14c></div><div data-v-85f2f14c></div><div data-v-85f2f14c></div><div data-v-85f2f14c></div></div> <!----> <p class="description" data-v-85f2f14c>Just wait a minute!</p></div> <div class="ant-layout"><div class="layout-sidebar ant-layout-sider ant-layout-sider-dark" style="flex:0 0 256px;max-width:256px;min-width:256px;width:256px;"><div class="ant-layout-sider-children"><div class="logo"><img src="/logo.png" alt="logo"></div> <ul role="menu" class="component-sidebar ant-menu ant-menu-inline ant-menu-root ant-menu-light" data-v-64538d34><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-selected" data-v-64538d34><div aria-haspopup="true" class="ant-menu-submenu-title" style="padding-left:24px;"><span data-v-64538d34>JavaScript</span><i class="ant-menu-submenu-arrow"></i></div><div></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-selected" data-v-64538d34><div aria-haspopup="true" class="ant-menu-submenu-title" style="padding-left:24px;"><span data-v-64538d34>CSS</span><i class="ant-menu-submenu-arrow"></i></div><div></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-selected" data-v-64538d34><div aria-haspopup="true" class="ant-menu-submenu-title" style="padding-left:24px;"><span data-v-64538d34>HTML</span><i class="ant-menu-submenu-arrow"></i></div><div></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-selected" data-v-64538d34><div aria-haspopup="true" class="ant-menu-submenu-title" style="padding-left:24px;"><span data-v-64538d34>HTTP</span><i class="ant-menu-submenu-arrow"></i></div><div></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-selected" data-v-64538d34><div aria-haspopup="true" class="ant-menu-submenu-title" style="padding-left:24px;"><span data-v-64538d34>浏览器环境</span><i class="ant-menu-submenu-arrow"></i></div><div></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-selected" data-v-64538d34><div aria-haspopup="true" class="ant-menu-submenu-title" style="padding-left:24px;"><span data-v-64538d34>数据结构与算法</span><i class="ant-menu-submenu-arrow"></i></div><div></div></li></ul></div></div> <div class="content-margin ant-layout"><div class="layout-header ant-layout-header"><div><span class="ant-avatar ant-avatar-circle ant-avatar-image navbar-avatar" style="width:55px;height:55px;line-height:55px;font-size:18px;"><img src="/avatar.jpg"></span> <div class="search-box search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <audio autoplay="autoplay" loop="loop"><source type="audio/mpeg" src="https://blog-source-1259421820.cos.ap-guangzhou.myqcloud.com/public/music.mp3"></audio> <div class="navbar-breadcrumb ant-breadcrumb"><span><span class="ant-breadcrumb-link"><a href="/" class="navbar-icon"><i aria-label="icon: home" class="anticon anticon-home"><svg viewBox="64 64 896 896" data-icon="home" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 0 0-44.4 0L77.5 505a63.9 63.9 0 0 0-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0 0 18.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"></path></svg></i> <span class="navbar-icon-title">Home</span></a></span><span class="ant-breadcrumb-separator">/</span></span><span><span class="ant-breadcrumb-link"><a href="/about" class="navbar-icon"><i aria-label="icon: user" class="anticon anticon-user"><svg viewBox="64 64 896 896" data-icon="user" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M858.5 763.6a374 374 0 0 0-80.6-119.5 375.63 375.63 0 0 0-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 0 0-80.6 119.5A371.7 371.7 0 0 0 136 901.8a8 8 0 0 0 8 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 0 0 8-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"></path></svg></i> <span class="navbar-icon-title">About</span></a></span><span class="ant-breadcrumb-separator">/</span></span><span><span class="ant-breadcrumb-link"><a href="https://github.com/Veminem" class="navbar-icon"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i> <span class="navbar-icon-title">GitHub</span></a></span><span class="ant-breadcrumb-separator">/</span></span></div></div> <i aria-label="icon: menu-fold" tabIndex="-1" class="trigger anticon anticon-menu-fold"><svg viewBox="64 64 896 896" data-icon="menu-fold" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"></path></svg></i></div> <div class="ant-layout-content"><div class="page"><div class="content__default"><h1 id="frontmatter-title"><a href="#frontmatter-title" class="header-anchor">#</a> XSS</h1> <h2 id="xss-攻击"><a href="#xss-攻击" class="header-anchor">#</a> XSS 攻击</h2> <p><strong>跨网站指令码 (Cross-site scripting, XSS)</strong> 是一种网站应用程序的安全漏洞攻击，是往 HTML 文件中或者 DOM 中注入恶意脚本，从而在用户浏览页面时利用注入的恶意脚本对用户实施攻击的一种手段。</p> <p>当页面被注入了恶意 JavaScript 脚本时，浏览器无法区分这些脚本是被恶意注入的还是正常的页面内容，所以恶意注入 JavaScript 脚本也拥有所有的脚本权限。</p> <ul><li><p><strong>窃取 Cookie 信息</strong></p> <p>恶意 JavaScript 可以通过 <code>document.cookie</code> 获取 Cookie 信息，然后通过 <code>XMLHttpRequest</code> 或者 <code>Fetch</code> 加上 CORS 功能将数据发送给恶意服务器。</p> <p>恶意服务器拿到用户的 Cookie 信息之后，就可以在其他电脑上模拟用户的登录，然后进行转账等操作。</p></li> <li><p><strong>监听用户行为</strong></p> <p>恶意 JavaScript 可以使用 <code>addEventListener</code> 接口来监听键盘事件，比如获取用户输入的信用卡等信息，将其发送到恶意服务器。</p></li> <li><p><strong>修改 DOM</strong></p> <p>通过修改 DOM 伪造假的登录窗口，用来欺骗用户输入用户名和密码等信息。</p></li> <li><p><strong>在页面内生成浮窗广告</strong></p> <p>这些广告会严重地影响用户体验。</p></li></ul> <h2 id="攻击方式"><a href="#攻击方式" class="header-anchor">#</a> 攻击方式</h2> <p>通常情况下，主要有<strong>存储型 XSS 攻击</strong>、<strong>反射型 XSS 攻击</strong>和<strong>基于 DOM 的 XSS 攻击</strong>三种方式来注入恶意脚本。</p> <h3 id="存储型-xss-攻击"><a href="#存储型-xss-攻击" class="header-anchor">#</a> 存储型 XSS 攻击</h3> <p>存储型 XSS 攻击向 HTML 文件中注入恶意脚本的方式可以参考下图：</p> <p><img src="/assets/img/04-stroage-xss-1.492f179c.png" alt="存储型 XSS 攻击"></p> <p>通过上图，可以看出存储型 XSS 攻击大致需要经过如下步骤：</p> <ul><li>首先黑客利用站点漏洞将一段恶意 JavaScript 代码提交到网站的数据库中</li> <li>然后用户向网站请求包含了恶意 JavaScript 脚本的页面</li> <li>当用户浏览该页面的时候，恶意脚本就会将用户的 Cookie 信息等数据上传到服务器</li></ul> <p>一个实际例子，2015 年喜马拉雅就被曝出了存储型 XSS 漏洞。</p> <p>起因是在用户设置专辑名称时，服务器对关键字过滤不严格，比如可以将专辑名称设置为一段 JavaScript，如下图所示：</p> <p><img src="/assets/img/04-stroage-xss-2.412813a2.png" alt="注入恶意脚本"></p> <p>当黑客将专辑名称设置为一段 JavaScript 代码并提交时，喜马拉雅的服务器会保存该段 JavaScript 代码到数据库中。</p> <p>然后当用户打开黑客设置的专辑时，这段代码就会在用户的页面里执行（如下图），这样就可以获取用户的 Cookie 等数据信息。</p> <p><img src="/assets/img/04-stroage-xss-3.ef451895.png" alt="盗取用户信息"></p> <p>当用户打开黑客设置的专辑页面时，服务器也会将这段恶意 JavaScript 代码返回给用户，因此这段恶意脚本就在用户的页面中执行。</p> <p>恶意脚本可以通过 <code>XMLHttpRequest</code> 或者 <code>Fetch</code> 将用户的 Cookie 数据上传到黑客的服务器，如下图所示：</p> <p><img src="/assets/img/04-stroage-xss-4.87ed8d82.png" alt="上传到恶意服务器"></p> <p>黑客拿到用户 Cookie 信息之后，就可以利用 Cookie 信息在其他机器上登录该用户的账号（如下图），并利用用户账号进行一些恶意操作。</p> <p><img src="/assets/img/04-stroage-xss-5.728ea5c5.png" alt="控制用户信息"></p> <p>以上就是存储型 XSS 攻击的一个典型案例。</p> <h3 id="反射型-xss-攻击"><a href="#反射型-xss-攻击" class="header-anchor">#</a> 反射型 XSS 攻击</h3> <p>在一个反射型 XSS 攻击过程中，恶意 JavaScript 脚本属于用户发送给网站请求中的一部分，随后网站又把恶意 JavaScript 脚本返回给用户。</p> <p>当恶意 JavaScript 脚本在用户页面中被执行时，黑客就可以利用该脚本做一些恶意操作。</p> <p>这样讲有点抽象，结合一个简单的 Node 服务程序来了解是反射型 XSS。</p> <p>首先使用 Node 来搭建一个简单的页面环境，搭建好的服务代码如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/* GET home page. */</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'Express'</span><span class="token punctuation">,</span> xss<span class="token punctuation">:</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>xss <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code>
<span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>&lt;%= title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>stylesheet<span class="token punctuation">'</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/stylesheets/style.css<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>&lt;%= title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Welcome to &lt;%= title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    &lt;%- xss %&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面这两段代码中，第一段是路由，第二段是视图，作用是将 URL 中 <code>xss</code> 参数的内容显示在页面。</p> <p>可以在本地演示下，比如打开 <code>http://localhost:3000/?xss=123</code> 这个链接，这样在页面中展示就是 <code>123</code> 。</p> <p><img src="data:image/png;base64,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" alt="正常打开页面"></p> <p>但当打开 <code>http://localhost:3000/?xss=&lt;script&gt;alert('你被xss攻击了')&lt;/script&gt;</code> 这段 URL 时，其结果如下图所示：</p> <p><img src="/assets/img/04-reflective-xss-2.1941ac1b.png" alt="反射型 XSS 攻击"></p> <p>通过这个操作，会发现用户将一段含有恶意代码的请求提交给 Web 服务器，Web 服务器接收到请求时，又将恶意代码反射给了浏览器端，这就是反射型 XSS 攻击。</p> <p>在现实生活中，黑客经常会通过 QQ 群或者邮件等渠道诱导用户去点击这些恶意链接，所以对于一些链接一定要慎之又慎。</p> <h3 id="基于-dom-的-xss-攻击"><a href="#基于-dom-的-xss-攻击" class="header-anchor">#</a> 基于 DOM 的 XSS 攻击</h3> <p>基于 DOM 的 XSS 攻击是不牵涉到页面 Web 服务器的。</p> <p>具体来讲，黑客通过各种手段将恶意脚本注入用户的页面中，比如通过网络劫持在页面传输过程中修改 HTML 页面的内容。</p> <p>这种劫持类型很多，有通过 WiFi 路由器劫持的，有通过本地恶意软件来劫持的，它们的共同点是在 Web 资源传输过程或者在用户使用页面的过程中修改 Web 页面的数据。</p> <h2 id="防御措施"><a href="#防御措施" class="header-anchor">#</a> 防御措施</h2> <p>存储型 XSS 攻击和反射型 XSS 攻击都是需要经过 Web 服务器来处理的，因此可以认为这两种类型的漏洞是服务端的安全漏洞。</p> <p>而基于 DOM 的 XSS 攻击全部都是在浏览器端完成的，因此基于 DOM 的 XSS 攻击是属于前端的安全漏洞。</p> <p>无论是何种类型的 XSS 攻击，它们都有一个共同点，那就是首先往浏览器中注入恶意脚本，然后再通过恶意脚本将用户信息发送至黑客部署的恶意服务器上。</p> <p>所以要阻止 XSS 攻击，可以通过阻止恶意 JavaScript 脚本的注入和恶意消息的发送来实现。</p> <h3 id="服务器对输入脚本进行过滤或转码"><a href="#服务器对输入脚本进行过滤或转码" class="header-anchor">#</a> 服务器对输入脚本进行过滤或转码</h3> <p>不管是反射型还是存储型 XSS 攻击，都可以在服务器端将一些关键的字符进行转码，比如最典型的：</p> <div class="language-js extra-class"><pre class="language-js"><code>code<span class="token punctuation">:</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'你被xss攻击了'</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>这段代码过滤后，只留下了：</p> <div class="language-js extra-class"><pre class="language-js"><code>code<span class="token punctuation">:</span>
</code></pre></div><p>这样，当用户再次请求该页面时，由于 <code>&lt;script&gt;</code> 标签的内容都被过滤了，所以这段脚本在客户端是不可能被执行的。</p> <p>除了过滤之外，服务器还可以对这些内容进行转码，还是上面那段代码，经过转码之后，效果如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code>code<span class="token punctuation">:</span><span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>script<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>你被xss攻击了<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>lt<span class="token punctuation">;</span><span class="token operator">/</span>script<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>
</code></pre></div><p>经过转码之后的内容，如 <code>&lt;script&gt;</code> 标签被转换为 <code>&amp;lt;script&amp;gt;</code>，因此即使这段脚本返回给页面，页面也不会执行这段脚本。</p> <h3 id="充分利用-csp"><a href="#充分利用-csp" class="header-anchor">#</a> 充分利用 CSP</h3> <p>虽然在服务器端执行过滤或者转码可以阻止 XSS 攻击的发生，但完全依靠服务器端依然是不够的，还需要把 CSP 等策略充分地利用起来，以降低 XSS 攻击带来的风险和后果。</p> <p>实施严格的 CSP 可以有效地防范 XSS 攻击，具体来讲 CSP 有如下几个功能：</p> <ul><li>限制加载其他域下的资源文件，这样即使黑客插入了一个 JavaScript 文件，这个 JavaScript 文件也是无法被加载的</li> <li>禁止向第三方域提交数据，这样用户数据也不会外泄</li> <li>禁止执行内联脚本和未授权的脚本</li> <li>提供上报机制，这样可以帮助尽快发现有哪些 XSS 攻击，以便尽快修复问题</li></ul> <h3 id="使用-httponly-属性"><a href="#使用-httponly-属性" class="header-anchor">#</a> 使用 HttpOnly 属性</h3> <p>由于很多 XSS 攻击都是来盗用 Cookie 的，因此还可以通过使用 <code>HttpOnly</code> 属性来保护 Cookie 的安全。</p> <p>通常服务器可以将某些 Cookie 设置为 <code>HttpOnly</code> 标志，<code>HttpOnly</code> 是服务器通过 HTTP 响应头来设置的，下面是打开 Google 时，HTTP 响应头中的一段：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">set</span><span class="token operator">-</span>cookie<span class="token punctuation">:</span> <span class="token constant">NID</span><span class="token operator">=</span><span class="token number">189</span><span class="token operator">=</span>M8q2FtWbsR8RlcldPVt7qkrqR38LmFY9jUxkKo3<span class="token operator">-</span><span class="token number">4</span>Bi6Qu_ocNOat7nkYZUTzolHjFnwBw0izgsATSI7TZyiiiaV94qGh<span class="token operator">-</span>BzEYsNVa7TZmjAYTxYTOM9L_<span class="token operator">-</span><span class="token number">0</span>CN9ipL6cXi8l6<span class="token operator">-</span>z41asXtm2uEwcOC5oh9djkffOMhWqQrlnCtOI<span class="token punctuation">;</span> expires<span class="token operator">=</span>Sat<span class="token punctuation">,</span> <span class="token number">18</span><span class="token operator">-</span>Apr<span class="token operator">-</span><span class="token number">2020</span> <span class="token number">06</span><span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">:</span><span class="token number">22</span> <span class="token constant">GMT</span><span class="token punctuation">;</span> path<span class="token operator">=</span><span class="token operator">/</span><span class="token punctuation">;</span> domain<span class="token operator">=</span><span class="token punctuation">.</span>google<span class="token punctuation">.</span>com<span class="token punctuation">;</span> HttpOnly
</code></pre></div><p>可以看到，<code>set-cookie</code> 属性值最后使用了 <code>HttpOnly</code> 来标记该 Cookie。</p> <p>顾名思义，使用 <code>HttpOnly</code> 标记的 Cookie 只能使用在 HTTP 请求过程中，所以无法通过 JavaScript 来读取这段 Cookie。</p> <p>还可以通过 Chrome 开发者工具来查看哪些 Cookie 被标记了 <code>HttpOnly</code>，如下图：</p> <p><img src="/assets/img/04-httponly.44124fc5.png" alt="HttpOnly"></p> <p>从图中可以看出，<code>NID</code> 这个 Cookie 的 <code>HttpOlny</code> 属性是被勾选上的，所以 <code>NID</code> 的内容是无法通过 <code>document.cookie</code> 是来读取的。</p> <p>由于 JavaScript 无法读取设置了 <code>HttpOnly</code> 的 Cookie 数据，所以即使页面被注入了恶意 JavaScript 脚本，也是无法获取到设置了 <code>HttpOnly</code> 的数据。因此一些比较重要的数据建议设置 <code>HttpOnly</code> 标志。</p> <h2 id="csp"><a href="#csp" class="header-anchor">#</a> CSP</h2> <p>CSP 的实质就是<strong>白名单制度</strong>，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。</p> <p>CSP 大大增强了网页的安全性。攻击者即使发现了漏洞，也没法注入脚本，除非还控制了一台列入了白名单的可信主机。</p> <p>两种方法可以启用 CSP。一种是通过 HTTP 头信息的 <code>Content-Security-Policy</code> 字段。</p> <p><img src="/assets/img/04-csp-1.2f6dd848.jpg" alt="Content-Security-Policy"></p> <div class="language-js extra-class"><pre class="language-js"><code>Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy<span class="token punctuation">:</span> script<span class="token operator">-</span>src <span class="token string">'self'</span><span class="token punctuation">;</span> object<span class="token operator">-</span>src <span class="token string">'none'</span><span class="token punctuation">;</span>
style<span class="token operator">-</span>src cdn<span class="token punctuation">.</span>example<span class="token punctuation">.</span>org third<span class="token operator">-</span>party<span class="token punctuation">.</span>org<span class="token punctuation">;</span> child<span class="token operator">-</span>src https<span class="token punctuation">:</span>
</code></pre></div><p>另一种是通过网页的 <code>&lt;meta&gt;</code> 标签：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span>
  <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Content-Security-Policy<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>script-src 'self'; object-src 'none'; style-src cdn.example.org third-party.org; child-src https:<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面代码中，CSP 做了如下配置：</p> <ul><li>脚本：只信任当前域名</li> <li><code>&lt;object&gt;</code> 标签：不信任任何 URL，即不加载任何资源</li> <li>样式表：只信任 <code>cdn.example.org</code> 和 <code>third-party.org</code></li> <li>框架：必须使用 HTTPS 协议加载</li> <li>其他资源：没有限制</li></ul> <p>启用后，不符合 CSP 的外部资源就会被阻止加载。</p> <p>Chrome 的报错信息：</p> <p><img src="/assets/img/04-csp-2.b19e955c.png" alt="Chrome 报错"></p> <h3 id="限制选项"><a href="#限制选项" class="header-anchor">#</a> 限制选项</h3> <p>CSP 提供了很多限制选项，涉及安全的各个方面。</p> <h4 id="资源加载限制"><a href="#资源加载限制" class="header-anchor">#</a> 资源加载限制</h4> <ul><li><code>script-src</code>：外部脚本</li> <li><code>style-src</code>：样式表</li> <li><code>img-src</code>：图像</li> <li><code>media-src</code>：媒体文件（音频和视频）</li> <li><code>font-src</code>：字体文件</li> <li><code>object-src</code>：插件（如 Flash）</li> <li><code>child-src</code>：框架</li> <li><code>frame-ancestors</code>：嵌入的外部资源（比如 <code>&lt;frame&gt;</code>、<code>&lt;iframe&gt;</code>、<code>&lt;embed&gt;</code> 和 <code>&lt;apple&gt;</code>）</li> <li><code>connect-src</code>：HTTP 连接（通过 <code>XMLHttpRequest</code>、<code>WebSockets</code>、<code>EventSource</code> 等）</li> <li><code>worker-src</code>：worker 脚本</li> <li><code>manifest-src</code>：manifest 文件</li></ul> <p><code>default-src</code> 用来设置上面各个选项的默认值。</p> <div class="language-js extra-class"><pre class="language-js"><code>Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy<span class="token punctuation">:</span> <span class="token keyword">default</span><span class="token operator">-</span>src <span class="token string">'self'</span>
</code></pre></div><p>上面代码限制<strong>所有的</strong>外部资源，都只能从当前域名加载。</p> <p>如果同时设置某个单选限制（比如 <code>font-src</code>）和 <code>default-src</code>，前者会覆盖后者，即字体文件会采用 <code>font-src</code> 的值，其他资源依然采用 <code>default-src</code> 的值。</p> <h4 id="url-限制"><a href="#url-限制" class="header-anchor">#</a> URL 限制</h4> <p>有时，网页会跟其他 URL 发生联系，这时也可以加以限制：</p> <ul><li><code>frame-ancestors</code>：限制嵌入框架的网页</li> <li><code>base-uri</code>：限制 <code>&lt;base#href&gt;</code></li> <li><code>form-action</code>：限制 <code>&lt;form#action&gt;</code></li></ul> <h4 id="其他限制"><a href="#其他限制" class="header-anchor">#</a> 其他限制</h4> <p>其他一些安全相关的功能，也放在了 CSP 里面：</p> <ul><li><code>block-all-mixed-content</code>：HTTPS 网页不得加载 HTTP 资源（浏览器已经默认开启）</li> <li><code>upgrade-insecure-requests</code>：自动将网页上所有加载外部资源的 HTTP 链接换成 HTTPS 协议</li> <li><code>plugin-types</code>：限制可以使用的插件格式</li> <li><code>sandbox</code>：浏览器行为的限制，比如不能有弹出窗口等</li></ul> <h4 id="report-uri"><a href="#report-uri" class="header-anchor">#</a> report-uri</h4> <p>有时，不仅希望防止 XSS，还希望记录此类行为。<code>report-uri</code> 就用来告诉浏览器，应该把注入行为报告给哪个网址。</p> <div class="language-js extra-class"><pre class="language-js"><code>Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy<span class="token punctuation">:</span> <span class="token keyword">default</span><span class="token operator">-</span>src <span class="token string">'self'</span><span class="token punctuation">;</span> <span class="token operator">...</span><span class="token punctuation">;</span> report<span class="token operator">-</span>uri <span class="token operator">/</span>my_amazing_csp_report_parser<span class="token punctuation">;</span>
</code></pre></div><p>上面代码指定，将注入行为报告给 <code>/my_amazing_csp_report_parser</code> 这个 URL。</p> <p>浏览器会使用 <code>POST</code> 方法发送一个JSON对象，下面是一个例子。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;csp-report&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;document-uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://example.org/page.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;referrer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://evil.example.com/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;blocked-uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://evil.example.com/evil.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;violated-directive&quot;</span><span class="token operator">:</span> <span class="token string">&quot;script-src 'self' https://apis.google.com&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;original-policy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;script-src 'self' https://apis.google.com; report-uri http://example.org/my_amazing_csp_report_parser&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/assets/img/04-csp-3.1b7ed028.png" alt="POST CSP"></p> <h4 id="content-security-policy-report-only"><a href="#content-security-policy-report-only" class="header-anchor">#</a> Content-Security-Policy-Report-Only</h4> <p>除了 <code>Content-Security-Policy</code>，还有一个 <code>Content-Security-Policy-Report-Only</code> 字段，表示不执行限制选项，只是记录违反限制的行为。</p> <p>它必须与 <code>report-uri</code> 选项配合使用：</p> <div class="language-js extra-class"><pre class="language-js"><code>Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy<span class="token operator">-</span>Report<span class="token operator">-</span>Only<span class="token punctuation">:</span> <span class="token keyword">default</span><span class="token operator">-</span>src <span class="token string">'self'</span><span class="token punctuation">;</span> <span class="token operator">...</span><span class="token punctuation">;</span> report<span class="token operator">-</span>uri <span class="token operator">/</span>my_amazing_csp_report_parser<span class="token punctuation">;</span>
</code></pre></div><h3 id="选项值"><a href="#选项值" class="header-anchor">#</a> 选项值</h3> <p>每个限制选项可以设置以下几种值，这些值就构成了白名单：</p> <ul><li>主机名：<code>example.org</code>，<code>https://example.com:443</code></li> <li>路径名：<code>example.org/resources/js/</code></li> <li>通配符：<code>*.example.org</code>，<code>*://example.com:*</code>（表示任意协议、任意子域名、任意端口）</li> <li>协议名：<code>https:</code>、<code>data:</code></li> <li>关键字 <code>'self'</code>：当前域名、需要加引号</li> <li>关键字 <code>‘none’</code>：禁止加载任何外部资源，需要加引号</li></ul> <p>多个值也可以并列，用空格分隔：</p> <div class="language-js extra-class"><pre class="language-js"><code>Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy<span class="token punctuation">:</span> script<span class="token operator">-</span>src <span class="token string">'self'</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>apis<span class="token punctuation">.</span>google<span class="token punctuation">.</span>com
</code></pre></div><p>如果同一个限制选项使用多次，只有第一次会生效：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 错误的写法</span>
script<span class="token operator">-</span>src https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>host1<span class="token punctuation">.</span>com<span class="token punctuation">;</span> script<span class="token operator">-</span>src https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>host2<span class="token punctuation">.</span>com

<span class="token comment">//正确的写法</span>
script<span class="token operator">-</span>src https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>host1<span class="token punctuation">.</span>com https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>host2<span class="token punctuation">.</span>com
</code></pre></div><p>如果不设置某个限制选项，就是默认允许任何值。</p> <h3 id="script-src-的特殊值"><a href="#script-src-的特殊值" class="header-anchor">#</a> script-src 的特殊值</h3> <p>除了常规值，<code>script-src</code> 还可以设置一些特殊值。注意，下面这些值都必须放在单引号里面。</p> <ul><li><code>'unsafe-inline'</code>： 允许执行页面内嵌的 <code>&lt;script&gt;</code> 标签和事件监听函数</li> <li><code>‘unsafe-eval’</code>： 允许将字符串当作代码执行，比如使用 <code>eval</code>、<code>setTimeout</code>、<code>setInterval</code> 和 <code>Function</code> 等函数</li> <li><code>‘nonce’</code> 值： 每次 HTTP 回应给出一个授权 token，页面内嵌脚本必须有这个 token，才会执行</li> <li><code>‘hash’</code> 值： 列出允许执行的脚本代码的 hash 值，页面内嵌脚本的哈希值只有吻合的情况下，才能执行</li></ul> <p><code>nonce</code> 值的例子如下，服务器发送网页的时候，告诉浏览器一个随机生成的 token：</p> <div class="language-js extra-class"><pre class="language-js"><code>Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy<span class="token punctuation">:</span> script<span class="token operator">-</span>src <span class="token string">'nonce-EDNnf03nceIOfn39fn3e9h3sdfa'</span>
</code></pre></div><p>页面内嵌脚本，必须有这个 token 才能执行：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">nonce</span><span class="token attr-value"><span class="token punctuation">=</span>EDNnf03nceIOfn39fn3e9h3sdfa</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// some code</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>hash</code> 值的例子如下，服务器给出一个允许执行的代码的 hash 值：</p> <div class="language-js extra-class"><pre class="language-js"><code>Content<span class="token operator">-</span>Security<span class="token operator">-</span>Policy<span class="token punctuation">:</span> script<span class="token operator">-</span>src <span class="token string">'sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng='</span>
</code></pre></div><p>下面的代码就会允许执行，因为 hash 值相符：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello, world.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>计算 hash 值的时候，<code>&lt;script&gt;</code> 标签不算在内。</p> <p>除了 <code>script-src</code> 选项，<code>nonce</code> 值和 <code>hash</code> 值还可以用在 <code>style-src</code> 选项，控制页面内嵌的样式表。</p> <h3 id="注意点"><a href="#注意点" class="header-anchor">#</a> 注意点</h3> <ol><li><p><code>script-src</code> 和 <code>object-src</code> 是必需的，除非设置了 <code>default-src</code></p> <p>因为攻击者只要能注入脚本，其他限制都可以规避。而 <code>object-src</code> 必设是因为 Flash 里面可以执行外部脚本。</p></li> <li><p><code>script-src</code> 不能使用 <code>unsafe-inline</code> 关键字（除非伴随一个 <code>nonce</code> 值），也不能允许设置 <code>data:</code> URL</p> <p>下面是两个恶意攻击的例子：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>evil()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>data:text/javascript,evil()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>必须特别注意 JSONP 的回调函数</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/path/jsonp?callback=alert(document.domain)//<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面的代码中，虽然加载的脚本来自当前域名，但是通过改写回调函数，攻击者依然可以执行恶意代码。</p></li></ol></div> <div data-v-4cfa9d3a><div class="ref-card ant-collapse" data-v-4cfa9d3a><div role="tablist" class="ant-collapse-item ant-collapse-no-arrow" data-v-4cfa9d3a><div role="button" tabIndex="0" class="ant-collapse-header"><i aria-label="icon: link" class="anticon anticon-link" data-v-4cfa9d3a data-v-4cfa9d3a><svg viewBox="64 64 896 896" data-icon="link" width="1em" height="1em" fill="currentColor" aria-hidden="true" data-v-4cfa9d3a><path d="M574 665.4a8.03 8.03 0 0 0-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 0 0-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 0 0 0 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 0 0 0 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 0 0-11.3 0L372.3 598.7a8.03 8.03 0 0 0 0 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"></path></svg></i>  阅读 &amp; 参考
      </div><!----></div></div></div></div></div> <div class="layout-footer ant-layout-footer"><div data-v-54c7d102><div class="ant-divider ant-divider-horizontal ant-divider-with-text" data-v-54c7d102><span class="ant-divider-inner-text">End</span></div>

  © 2019-Present Created by Vincent Hy
  <i aria-label="icon: chrome" class="anticon anticon-chrome" data-v-54c7d102 data-v-54c7d102><svg viewBox="64 64 896 896" data-icon="chrome" width="1em" height="1em" fill="currentColor" aria-hidden="true" class="anticon-spin" data-v-54c7d102><path d="M371.8 512c0 77.5 62.7 140.2 140.2 140.2S652.2 589.5 652.2 512 589.5 371.8 512 371.8 371.8 434.4 371.8 512zM900 362.4l-234.3 12.1c63.6 74.3 64.6 181.5 11.1 263.7l-188 289.2c78 4.2 158.4-12.9 231.2-55.2 180-104 253-322.1 180-509.8zM320.3 591.9L163.8 284.1A415.35 415.35 0 0 0 96 512c0 208 152.3 380.3 351.4 410.8l106.9-209.4c-96.6 18.2-189.9-34.8-234-121.5zm218.5-285.5l344.4 18.1C848 254.7 792.6 194 719.8 151.7 653.9 113.6 581.5 95.5 510.5 96c-122.5.5-242.2 55.2-322.1 154.5l128.2 196.9c32-91.9 124.8-146.7 222.2-141z"></path></svg></i>
  Powered by
  <a href="https://github.com/vuejs/vuepress" target="view_window" data-v-54c7d102>Vuepress</a>
  | Theme by
  <a href="https://github.com/Veminem/vuepress-theme-oneN" target="view_window" data-v-54c7d102>oneN</a></div></div> <div data-v-1ef48251><i aria-label="icon: bars" tabIndex="-1" class="toc-button anticon anticon-bars" data-v-1ef48251 data-v-1ef48251 data-v-1ef48251><svg viewBox="0 0 1024 1024" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true" data-v-1ef48251><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <!----></div> <!----></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0e27453d.js" defer></script><script src="/assets/js/3.2e4f50e3.js" defer></script><script src="/assets/js/5.fd216eaf.js" defer></script><script src="/assets/js/33.1a15a89b.js" defer></script>
  </body>
</html>
