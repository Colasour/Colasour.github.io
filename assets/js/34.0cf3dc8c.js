(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{275:function(t,s,a){"use strict";a.r(s);var n=a(35),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"frontmatter-title"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#frontmatter-title"}},[t._v("#")]),t._v(" "+t._s(t.$frontmatter.title))]),t._v(" "),n("h2",{attrs:{id:"同源策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[t._v("#")]),t._v(" 同源策略")]),t._v(" "),n("p",[t._v("如果两个 URL 的协议、域名、端口都相同，就称这两个 URL "),n("strong",[t._v("同源")]),t._v("。")]),t._v(" "),n("p",[t._v("下表给出了相对 "),n("code",[t._v("http://store.company.com/dir/page.html")]),t._v(" 同源检测的示例：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("URL")]),t._v(" "),n("th",[t._v("结果")]),t._v(" "),n("th",[t._v("原因")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[n("code",[t._v("http://store.company.com/dir2/other.html")])]),t._v(" "),n("td",[t._v("成功")]),t._v(" "),n("td",[t._v("只有路径不同")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("http://store.company.com/dir/inner/another.html")])]),t._v(" "),n("td",[t._v("成功")]),t._v(" "),n("td",[t._v("只有路径不同")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("https://store.company.com/secure.html")])]),t._v(" "),n("td",[t._v("失败")]),t._v(" "),n("td",[t._v("不同协议（https 和 http）")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("http://store.company.com:81/dir/etc.html")])]),t._v(" "),n("td",[t._v("失败")]),t._v(" "),n("td",[t._v("不同端口（"),n("code",[t._v("http://")]),t._v(" 默认是 80）")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("http://news.company.com/dir/other.html")])]),t._v(" "),n("td",[t._v("失败")]),t._v(" "),n("td",[t._v("不同域名（news 和 store）")])])])]),t._v(" "),n("p",[t._v("浏览器默认两个相同的源之间是可以相互访问资源和操作 DOM 的。")]),t._v(" "),n("p",[t._v("两个不同的源之间若想要相互访问资源或者操作 DOM，那么会有一套基础的安全策略的制约，我们把这称为"),n("strong",[t._v("同源策略 (Same-origin policy)")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"限制范围"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#限制范围"}},[t._v("#")]),t._v(" 限制范围")]),t._v(" "),n("ul",[n("li",[t._v("无法读取非同源地址的 "),n("code",[t._v("Cookie")]),t._v("、"),n("code",[t._v("LocalStorage")]),t._v(" 和 "),n("code",[t._v("IndexDB")])]),t._v(" "),n("li",[t._v("无法接触非同源地址的 DOM")]),t._v(" "),n("li",[t._v("无法向非同源地址发送 AJAX 请求（可以发送，但浏览器会拒绝接受响应）")])]),t._v(" "),n("h2",{attrs:{id:"cookie"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[t._v("#")]),t._v(" Cookie")]),t._v(" "),n("p",[t._v("Cookie 是服务器写入浏览器的一小段信息，只有同源的网页才能共享。")]),t._v(" "),n("p",[t._v("如果两个网页"),n("strong",[t._v("一级域名相同")]),t._v("，只是次级域名不同，浏览器允许通过设置 "),n("code",[t._v("document.domain")]),t._v(" 共享 Cookie。")]),t._v(" "),n("p",[t._v("举例来说，A 网页的网址是 "),n("code",[t._v("http://w1.example.com/a.html")]),t._v("，B 网页的网址是 "),n("code",[t._v("http://w2.example.com/b.html")]),t._v("，那么只要设置相同的 "),n("code",[t._v("document.domain")]),t._v("，两个网页就可以共享 Cookie。因为浏览器通过 "),n("code",[t._v("document.domain")]),t._v(" 属性来检查是否同源。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 两个网页都需要设置")]),t._v("\ndocument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'example.com'")]),t._v("\n")])])]),n("p",[t._v("A 和 B 两个网页都需要设置 "),n("code",[t._v("document.domain")]),t._v(" 属性，才能达到同源的目的。")]),t._v(" "),n("p",[t._v("因为设置 "),n("code",[t._v("document.domain")]),t._v(" 的同时，会把端口重置为 "),n("code",[t._v("null")]),t._v("，因此如果只设置一个网页的 "),n("code",[t._v("document.domain")]),t._v("，会导致两个网址的端口不同，还是达不到同源的目的。")]),t._v(" "),n("p",[t._v("现在，A 网页通过脚本设置一个 Cookie：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test1=hello"')]),t._v("\n")])])]),n("p",[t._v("B 网页就可以读到这个 Cookie：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" allCookie "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[t._v("这种方法只适用于 Cookie 和 "),n("code",[t._v("iframe")]),t._v(" 窗口，"),n("code",[t._v("LocalStorage")]),t._v(" 和 "),n("code",[t._v("IndexedDB")]),t._v(" 无法通过这种方法规避同源政策。")])]),t._v(" "),n("p",[t._v("服务器也可以在设置 Cookie 的时候，指定 Cookie 的所属域名为一级域名，比如 "),n("code",[t._v(".example.com")]),t._v("：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Set"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Cookie"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" domain"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])])]),n("p",[t._v("这样的话，二级域名和三级域名不用做任何设置，都可以读取这个 Cookie。")]),t._v(" "),n("h2",{attrs:{id:"iframe-和多窗口通信"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#iframe-和多窗口通信"}},[t._v("#")]),t._v(" iframe 和多窗口通信")]),t._v(" "),n("p",[n("code",[t._v("iframe")]),t._v(" 元素可以在当前网页之中，嵌入其他网页。每个 "),n("code",[t._v("iframe")]),t._v(" 元素形成自己的窗口，即有自己的 "),n("code",[t._v("window")]),t._v(" 对象。")]),t._v(" "),n("p",[n("code",[t._v("iframe")]),t._v("窗口之中的脚本，可以获得父窗口和子窗口。但只有在同源的情况下，父窗口和子窗口才能通信；如果跨域，就无法拿到对方的 DOM。")]),t._v(" "),n("p",[t._v("比如，父窗口运行下面的命令，如果 "),n("code",[t._v("iframe")]),t._v(" 窗口不是同源，就会报错。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("document\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myIFrame"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Uncaught DOMException: Blocked a frame from accessing a cross-origin frame")]),t._v("\n")])])]),n("p",[t._v("反之亦然，子窗口获取主窗口的 DOM 也会报错。")]),t._v(" "),n("p",[t._v("这种情况不仅适用于 "),n("code",[t._v("iframe")]),t._v(" 窗口，还适用于 "),n("code",[t._v("window.open")]),t._v(" 方法打开的窗口，只要跨域，父窗口与子窗口之间就无法通信。")]),t._v(" "),n("p",[t._v("如果两个窗口一级域名相同，只是二级域名不同，那么设置 "),n("code",[t._v("document.domain")]),t._v(" 属性可以规避同源政策，拿到 DOM。")]),t._v(" "),n("p",[t._v("对于完全不同源的网站，目前有两种方法，可以解决跨域窗口的通信问题。")]),t._v(" "),n("h3",{attrs:{id:"片段标识符"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#片段标识符"}},[t._v("#")]),t._v(" 片段标识符")]),t._v(" "),n("p",[n("strong",[t._v("片段标识符 (fragment identifier)")]),t._v(" 指的是 URL 的 "),n("code",[t._v("#")]),t._v(" 号后面的部分，比如 "),n("code",[t._v("http://example.com/x.html#fragment")]),t._v(" 的 "),n("code",[t._v("#fragment")]),t._v("。")]),t._v(" "),n("p",[t._v("如果只是改变片段标识符，页面不会重新刷新。父窗口可以把信息，写入子窗口的片段标识符。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" src "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" originURL "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" data\ndocument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myIFrame'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" src\n")])])]),n("p",[t._v("子窗口通过监听 "),n("code",[t._v("hashchange")]),t._v(" 事件得到通知：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onhashchange "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" checkMessage\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" message "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hash\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("同样的，子窗口也可以改变父窗口的片段标识符：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" target "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" hash\n")])])]),n("h3",{attrs:{id:"window-postmessage"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#window-postmessage"}},[t._v("#")]),t._v(" window.postMessage")]),t._v(" "),n("p",[t._v("上面的这种方法属于破解，HTML5 为了解决这个问题，引入了一个全新的API："),n("strong",[t._v("跨文档通信 API (Cross-document messaging)")]),t._v("。")]),t._v(" "),n("p",[t._v("这个 API 为 "),n("code",[t._v("window")]),t._v(" 对象新增了一个 "),n("code",[t._v("window.postMessage")]),t._v(" 方法，允许跨窗口通信，不论这两个窗口是否同源。")]),t._v(" "),n("p",[t._v("举例来说，父窗口 "),n("code",[t._v("aaa.com")]),t._v(" 向子窗口 "),n("code",[t._v("bbb.com")]),t._v(" 发消息，调用 "),n("code",[t._v("postMessage")]),t._v(" 方法就可以了。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 父窗口打开一个子窗口")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" popup "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 父窗口向子窗口发消息")]),t._v("\npopup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[n("code",[t._v("postMessage")]),t._v(" 方法的第一个参数是具体的信息内容，第二个参数是接收消息的窗口的源 (origin)。也可以设为 "),n("code",[t._v("*")]),t._v("，表示不限制域名，向所有窗口发送。")]),t._v(" "),n("p",[t._v("子窗口向父窗口发送消息的写法类似：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 子窗口向父窗口发消息")]),t._v("\nwindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("opener"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Nice to see you'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://aaa.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("父窗口和子窗口都可以通过 "),n("code",[t._v("message")]),t._v(" 事件，监听对方的消息：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 父窗口和子窗口都可以用下面的代码")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听 message 消息")]),t._v("\nwindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[n("code",[t._v("message")]),t._v(" 事件的参数是事件对象 "),n("code",[t._v("event")]),t._v("，提供以下三个属性：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("event.source")]),t._v("：发送消息的窗口")]),t._v(" "),n("li",[n("code",[t._v("event.origin")]),t._v("：消息发送的网址")]),t._v(" "),n("li",[n("code",[t._v("event.data")]),t._v("：消息内容")])]),t._v(" "),n("h3",{attrs:{id:"localstorage"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#localstorage"}},[t._v("#")]),t._v(" LocalStorage")]),t._v(" "),n("p",[t._v("通过 "),n("code",[t._v("window.postMessage")]),t._v("，读取其他窗口的 LocalStorage 也成为了可能。")]),t._v(" "),n("p",[t._v("下面是一个例子，主窗口写入 "),n("code",[t._v("iframe")]),t._v(" 子窗口的  "),n("code",[t._v("localStorage")]),t._v("：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" payload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  localStorage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("paylaod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("上面代码中，子窗口将父窗口发来的消息，写入自己的 LocalStorage。")]),t._v(" "),n("p",[t._v("父窗口发送消息的代码如下：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" win "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementByTagName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iframe'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" obj "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Jack'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nwin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'storage'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'obj'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h2",{attrs:{id:"ajax"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ajax"}},[t._v("#")]),t._v(" AJAX")]),t._v(" "),n("p",[t._v("同源政策规定，AJAX 请求只能发给同源的网址，否则就报错。")]),t._v(" "),n("p",[t._v("除了架设服务器代理（浏览器请求同源服务器，再由后者请求外部服务），有以下三种方法规避这个限制。")]),t._v(" "),n("h3",{attrs:{id:"jsonp"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jsonp"}},[t._v("#")]),t._v(" JSONP")]),t._v(" "),n("p",[t._v("JSONP 是服务器与客户端跨源通信的常用方法。最大特点就是简单易用，"),n("strong",[t._v("没有兼容性")]),t._v("问题，老式浏览器全部支持，服务端改造非常小。")]),t._v(" "),n("p",[t._v("它的做法如下：")]),t._v(" "),n("p",[t._v("第一步，网页添加一个 "),n("code",[t._v("<script>")]),t._v(" 元素，向服务器请求一个脚本，这不受同源策略限制，可以跨域请求。")]),t._v(" "),n("div",{staticClass:"language-html extra-class"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://api.foo.com?callback=bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}}),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[t._v("请求的脚本网址有一个 "),n("code",[t._v("callback")]),t._v(" 参数 "),n("code",[t._v("?callback=bar")]),t._v("，用来告诉服务器，客户端的回调函数名称 "),n("code",[t._v("bar")]),t._v("。")])]),t._v(" "),n("p",[t._v("第二步，服务器收到请求后，拼接一个字符串，将 JSON 数据放在函数名里面，作为字符串返回 "),n("code",[t._v("bar({...})")]),t._v("。")]),t._v(" "),n("p",[t._v("第三步，客户端会将服务器返回的字符串，作为代码解析。")]),t._v(" "),n("p",[t._v("因为浏览器认为，这是 "),n("code",[t._v("<script>")]),t._v(" 标签请求的脚本内容。这时，客户端只要定义了 "),n("code",[t._v("bar()")]),t._v(" 函数，就能在该函数体内，拿到服务器返回的 JSON 数据。")]),t._v(" "),n("p",[t._v("下面看一个实例。首先，网页动态插入 "),n("code",[t._v("<script>")]),t._v(" 元素，由它向跨域网址发出请求。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addScriptTag")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" script "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/script'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" src\n  document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nwindow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addScriptTag")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://example.com/ip?callback=foo'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Your public IP address is: '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("上面代码通过动态添加 "),n("code",[t._v("<script>")]),t._v(" 元素，向服务器 "),n("code",[t._v("example.com")]),t._v(" 发出请求。")]),t._v(" "),n("p",[t._v("服务器收到这个请求后，会将数据放在回调函数的参数位置返回。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ip'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'8.8.8.8'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("由于 "),n("code",[t._v("<script>")]),t._v(" 元素请求的脚本，直接作为代码运行。这时，只要浏览器定义了 "),n("code",[t._v("foo")]),t._v(" 函数，该函数就会立即调用。")]),t._v(" "),n("p",[t._v("作为参数的 JSON 数据被视为 JavaScript 对象，而不是字符串，因此避免了使用 "),n("code",[t._v("JSON.parse")]),t._v(" 的步骤。")]),t._v(" "),n("h3",{attrs:{id:"websocket"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#websocket"}},[t._v("#")]),t._v(" WebSocket")]),t._v(" "),n("p",[t._v("WebSocket 是 HTML5 中的协议，支持"),n("strong",[t._v("持久连接")]),t._v("。")]),t._v(" "),n("p",[t._v("WebSocket 最大特点是，服务器可以"),n("strong",[t._v("主动")]),t._v("向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于"),n("strong",[t._v("服务器推送技术")]),t._v("的一种。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(384),alt:"websocket"}})]),t._v(" "),n("p",[t._v("其他特点包括：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("建立在 TCP 协议之上，服务器端的实现比较容易")])]),t._v(" "),n("li",[n("p",[t._v("与 HTTP 协议有着良好的兼容性，默认端口也是 "),n("code",[t._v("80")]),t._v(" 和 "),n("code",[t._v("443")]),t._v("，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器")])]),t._v(" "),n("li",[n("p",[t._v("数据格式比较轻量，性能开销小，通信高效")])]),t._v(" "),n("li",[n("p",[t._v("可以发送文本，也可以发送二进制数据")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("没有")]),t._v("同源限制，客户端可以与任意服务器通信")])]),t._v(" "),n("li",[n("p",[t._v("协议标识符是  "),n("code",[t._v("ws")]),t._v("（如果加密，则为 "),n("code",[t._v("wss")]),t._v("），服务器网址就是 URL")]),t._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[t._v("ws"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//example.com:80/some/path")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(385),alt:"ws&wss"}})])])]),t._v(" "),n("p",[t._v("WebSocket 网页脚本例子")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ws "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wss://echo.websocket.org'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onopen")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("evt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定连接成功后的回调函数")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Connection open ...'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello WebSockets!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// send 方法用于向服务器发送数据")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("evt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定收到服务器数据后的回调函数")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Received Message: '")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" evt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  ws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onclose")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("evt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定连接结束后的回调函数")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Connection closed.'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nws"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("evt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定报错时的回调函数")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// handle error event")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("webSocket.readyState")]),t._v(" 属性返回实例对象的当前状态，共有四种：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("值")]),t._v(" "),n("th",[t._v("状态")]),t._v(" "),n("th",[t._v("描述")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[n("code",[t._v("0")])]),t._v(" "),n("td",[t._v("CONNECTING")]),t._v(" "),n("td",[t._v("表示正在连接")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("1")])]),t._v(" "),n("td",[t._v("OPEN")]),t._v(" "),n("td",[t._v("表示连接成功，可以通信")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("2")])]),t._v(" "),n("td",[t._v("CLOSING")]),t._v(" "),n("td",[t._v("表示连接正在关闭")])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("3")])]),t._v(" "),n("td",[t._v("CLOSED")]),t._v(" "),n("td",[t._v("表示连接已经关闭，或者打开连接失败")])])])]),t._v(" "),n("h3",{attrs:{id:"cors"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[t._v("#")]),t._v(" CORS")]),t._v(" "),n("p",[t._v("CORS（跨源资源分享, Cross-Origin Resource Sharing），它是 W3C 标准，属于跨源 AJAX 请求的根本解决方法。")]),t._v(" "),n("p",[t._v("相比 JSONP 只能发送 "),n("code",[t._v("GET")]),t._v(" 请求，CORS 允许任何类型的请求。")])])}),[],!1,null,null,null);s.default=e.exports},384:function(t,s,a){t.exports=a.p+"assets/img/02-websocket.d7c94108.png"},385:function(t,s,a){t.exports=a.p+"assets/img/02-ws&wss.bdadb8dd.jpg"}}]);