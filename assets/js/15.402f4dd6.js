(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{299:function(v,_,t){"use strict";t.r(_);var e=t(35),s=Object(e.a)({},(function(){var v=this,_=v.$createElement,e=v._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("h1",{attrs:{id:"frontmatter-title"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#frontmatter-title"}},[v._v("#")]),v._v(" "+v._s(v.$frontmatter.title))]),v._v(" "),e("h2",{attrs:{id:"报文结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#报文结构"}},[v._v("#")]),v._v(" 报文结构")]),v._v(" "),e("p",[v._v("HTTP 协议的请求报文和响应报文的结构基本相同，由三大部分组成：")]),v._v(" "),e("ol",[e("li",[v._v("起始行 (start line)：描述请求或响应的基本信息")]),v._v(" "),e("li",[v._v("头部字段集合 (header)：使用 "),e("code",[v._v("key-value")]),v._v(" 形式更详细地说明报文")]),v._v(" "),e("li",[v._v("消息正文 (entity)：实际传输的数据，它不一定是纯文本，可以是图片、视频等二进制数据")])]),v._v(" "),e("p",[v._v("这其中前两部分起始行和头部字段经常又合称为“"),e("strong",[v._v("请求头")]),v._v("”或“响应头”，消息正文又称为“"),e("strong",[v._v("实体")]),v._v("”，但与 "),e("code",[v._v("header")]),v._v(" 对应，很多时间就直接称为 "),e("code",[v._v("body")]),v._v("。")]),v._v(" "),e("p",[v._v("HTTP 协议规定报文必须有 "),e("code",[v._v("header")]),v._v("，但可以没有 "),e("code",[v._v("body")]),v._v("，而且在 "),e("code",[v._v("header")]),v._v(" 之后必须要有一个“空行”，也就是 "),e("code",[v._v("CRLF")]),v._v("，十六进制的 "),e("code",[v._v("ODOA")]),v._v("。")]),v._v(" "),e("p",[e("img",{attrs:{src:t(499),alt:"HTTP报文结构"}})]),v._v(" "),e("p",[v._v("用 Wireshark 抓包的报文内容：")]),v._v(" "),e("p",[e("img",{attrs:{src:t(500),alt:"GET报文"}})]),v._v(" "),e("p",[v._v("在这个浏览器发出的请求报文中，第一行 "),e("code",[v._v("GET / HTTP/1.1")]),v._v(" 就是请求行，而后面的 "),e("code",[v._v("Host")]),v._v("、"),e("code",[v._v("Connection")]),v._v(" 等都属于 "),e("code",[v._v("header")]),v._v("，报文的最后是一个空白行结束，没有 "),e("code",[v._v("body")]),v._v("。")]),v._v(" "),e("p",[v._v("在很多时候，特别是浏览器发送 "),e("code",[v._v("GET")]),v._v(" 请求的时候都是这样，HTTP 报文经常是只有 "),e("code",[v._v("header")]),v._v(" 而没有 "),e("code",[v._v("body")]),v._v("。")]),v._v(" "),e("h2",{attrs:{id:"请求行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#请求行"}},[v._v("#")]),v._v(" 请求行")]),v._v(" "),e("p",[e("strong",[v._v("请求行 (request line)")]),v._v(" 简要地描述了"),e("strong",[v._v("客户端想要如何操作服务器端的资源")]),v._v("。")]),v._v(" "),e("p",[v._v("请求行由三部分组成：")]),v._v(" "),e("ol",[e("li",[v._v("请求方法：一个动词，如 "),e("code",[v._v("GET")]),v._v("、"),e("code",[v._v("POST")]),v._v("，表示对资源的操作")]),v._v(" "),e("li",[v._v("请求目标：通常是一个 URI，标记了请求方法要操作的资源")]),v._v(" "),e("li",[v._v("版本号：表示报文使用的 HTTP 协议版本")])]),v._v(" "),e("p",[v._v("这三部分通常使用空格 (space) 来分隔，最后要用 "),e("code",[v._v("CRLF")]),v._v(" 换行表示结束。")]),v._v(" "),e("p",[e("img",{attrs:{src:t(501),alt:"请求行"}})]),v._v(" "),e("h2",{attrs:{id:"状态行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#状态行"}},[v._v("#")]),v._v(" 状态行")]),v._v(" "),e("p",[v._v("响应报文里的起始行不叫“响应行”，而是“"),e("strong",[v._v("状态行 (status line)")]),v._v("”，意思是"),e("strong",[v._v("服务器响应的状态")]),v._v("。")]),v._v(" "),e("p",[v._v("状态行由三部分组成：")]),v._v(" "),e("ol",[e("li",[v._v("版本号：表示报文使用的 HTTP 协议版本")]),v._v(" "),e("li",[v._v("状态码：一个三位数，用代码的形式表示处理的结果")]),v._v(" "),e("li",[v._v("原因：作为数字状态码的补充，是更详细的解释文字")])]),v._v(" "),e("p",[e("img",{attrs:{src:t(502),alt:"状态行"}})]),v._v(" "),e("h2",{attrs:{id:"头部字段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#头部字段"}},[v._v("#")]),v._v(" 头部字段")]),v._v(" "),e("p",[v._v("请求行或状态行加上头部字段集合就构成了 HTTP 报文里的完整的"),e("strong",[v._v("请求头")]),v._v("或"),e("strong",[v._v("响应头")]),v._v("。")]),v._v(" "),e("p",[e("img",{attrs:{src:t(503),alt:"请求头"}})]),v._v(" "),e("p",[e("img",{attrs:{src:t(504),alt:"响应头"}})]),v._v(" "),e("p",[v._v("请求头和响应头的结构是基本一致的，唯一的区别是起始行。")]),v._v(" "),e("p",[v._v("头部字段是 "),e("code",[v._v("key-value")]),v._v(" 的形式，"),e("code",[v._v("key")]),v._v(" 和 "),e("code",[v._v("value")]),v._v(" 之间用 "),e("code",[v._v(":")]),v._v(" 分隔，最后用 "),e("code",[v._v("CRLF")]),v._v(" 换行表示字段结束。比如在 "),e("code",[v._v("Host: 127.0.0.1")]),v._v(" 这一行里 "),e("code",[v._v("key")]),v._v(" 是 "),e("code",[v._v("Host")]),v._v("，"),e("code",[v._v("value")]),v._v(" 是 "),e("code",[v._v("127.0.0.1")]),v._v("。")]),v._v(" "),e("p",[v._v("HTTP 头部字段非常灵活，不仅可以使用标准里的 "),e("code",[v._v("Host")]),v._v("、"),e("code",[v._v("Connection")]),v._v(" 等已有头，也可以任意添加"),e("strong",[v._v("自定义头")]),v._v("，这就给 HTTP 协议带来了无限的扩展可能。")]),v._v(" "),e("h3",{attrs:{id:"注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[v._v("#")]),v._v(" 注意事项")]),v._v(" "),e("ul",[e("li",[v._v("字段名不区分大小写，例如 "),e("code",[v._v("Host")]),v._v(" 也可以写成 "),e("code",[v._v("host")]),v._v("，但首字母大写的可读性更好")]),v._v(" "),e("li",[v._v("字段名里"),e("strong",[v._v("不允许")]),v._v("出现空格，可以使用连字符 "),e("code",[v._v("-")]),v._v("，但不能使用下划线 "),e("code",[v._v("_")]),v._v("，例如 "),e("code",[v._v("test-name")]),v._v(" 是合法的字段名，而 "),e("code",[v._v("test_name")]),v._v("、"),e("code",[v._v("test name")]),v._v(" 是不合法的字段名")]),v._v(" "),e("li",[v._v("字段名后面必须紧接着 "),e("code",[v._v(":")]),v._v("，不能有空格，而 "),e("code",[v._v(":")]),v._v(" 后的字段值前可以有多个空格")]),v._v(" "),e("li",[v._v("字段的顺序是没有意义的，可以任意排列不影响语义")]),v._v(" "),e("li",[v._v("字段原则上不能重复，除非这个字段本身的语义允许，例如 "),e("code",[v._v("Set-Cookie")])])]),v._v(" "),e("h3",{attrs:{id:"常用头字段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用头字段"}},[v._v("#")]),v._v(" 常用头字段")]),v._v(" "),e("p",[v._v("HTTP 协议规定了非常多的头部字段，实现各种各样的功能，但基本上可以分为四大类：")]),v._v(" "),e("ol",[e("li",[v._v("通用字段：在请求头和响应头里都可以出现")]),v._v(" "),e("li",[v._v("请求字段：仅能出现在请求头里，进一步说明请求信息或者额外的附加条件")]),v._v(" "),e("li",[v._v("响应字段：仅能出现在响应头里，补充说明响应报文的信息")]),v._v(" "),e("li",[v._v("实体字段：它实际属于通用字段，但专门描述 "),e("code",[v._v("body")]),v._v(" 的额外信息")])]),v._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",[v._v("对 HTTP 报文的解析和处理实际上主要就是对头字段的处理，理解了头字段也就理解了 HTTP 报文。")])]),v._v(" "),e("h4",{attrs:{id:"host"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#host"}},[v._v("#")]),v._v(" Host")]),v._v(" "),e("p",[e("code",[v._v("Host")]),v._v(" 字段属于"),e("strong",[v._v("请求字段")]),v._v("，只能出现在请求头里，它同时也是唯一一个 HTTP/1.1 规范里要求 "),e("strong",[v._v("必须出现")]),v._v(" 的字段。")]),v._v(" "),e("p",[v._v("也就是说，如果请求头里没有 "),e("code",[v._v("Host")]),v._v("，那这就是一个错误的报文。")]),v._v(" "),e("p",[e("code",[v._v("Host")]),v._v(" 字段告诉服务器这个请求应该由哪个主机来处理，当一台计算机上托管了多个虚拟主机的时候，服务器端就需要用 "),e("code",[v._v("Host")]),v._v(" 字段来选择，有点像是一个简单的“路由重定向”。")]),v._v(" "),e("h4",{attrs:{id:"user-agent"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#user-agent"}},[v._v("#")]),v._v(" User-Agent")]),v._v(" "),e("p",[e("code",[v._v("User-Agent")]),v._v(" 字段也是"),e("strong",[v._v("请求字段")]),v._v("，只出现在请求头里。它使用一个字符串来描述发起 HTTP 请求的客户端，服务器可以依据它来返回最合适此浏览器显示的页面。")]),v._v(" "),e("p",[v._v("但由于历史的原因，"),e("code",[v._v("User-Agent")]),v._v(' 非常混乱，每个浏览器都自称是 "Mozilla"、"Chrome"、"Safari"，企图使用这个字段来相互“伪装”，导致 '),e("code",[v._v("User-Agent")]),v._v(" 变得越来越差了，最终变得毫无意义。")]),v._v(" "),e("h4",{attrs:{id:"date"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#date"}},[v._v("#")]),v._v(" Date")]),v._v(" "),e("p",[e("code",[v._v("Date")]),v._v(" 字段是一个"),e("strong",[v._v("通用字段")]),v._v("，但通常出现在响应头里，表示 HTTP 报文创建的时间，客户端可以使用这个时间再搭配其他字段决定缓存策略。")]),v._v(" "),e("h4",{attrs:{id:"server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[v._v("#")]),v._v(" Server")]),v._v(" "),e("p",[e("code",[v._v("Server")]),v._v(" 字段是"),e("strong",[v._v("响应字段")]),v._v("，只能出现在响应头里。它告诉客户端当前正在提供 Web 服务的软件名称和版本号。")]),v._v(" "),e("p",[e("code",[v._v("Server")]),v._v(" 字段不是必须出现的，因为这会把服务器的一部分信息暴露给外界，如果这个版本恰好存在 bug，那么黑客就有可能利用 bug 攻陷服务器。所以，有的网站响应头里要么没有这个字段，要么就给出一个完全无关的描述信息。")]),v._v(" "),e("p",[v._v("比如 GitHub，它的 "),e("code",[v._v("Server")]),v._v(' 字段里就看不出是使用了 Apache 还是 Nginx，只是显示为 "GitHub.com"。')]),v._v(" "),e("p",[e("img",{attrs:{src:t(505),alt:"github"}})]),v._v(" "),e("h4",{attrs:{id:"content-length"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#content-length"}},[v._v("#")]),v._v(" Content-Length")]),v._v(" "),e("p",[e("code",[v._v("Content-Length")]),v._v(" 字段表示报文里的 body 长度，也就是请求头或响应头空行后面数据的长度。")]),v._v(" "),e("p",[v._v("服务器看到这个字段，就知道了后续有多少数据，可以直接接收。")]),v._v(" "),e("p",[v._v("如果没有这个字段，那么 body 就是不定长的，需要使用 "),e("code",[v._v("chunked")]),v._v(" 方式分段传输。")])])}),[],!1,null,null,null);_.default=s.exports},499:function(v,_,t){v.exports=t.p+"assets/img/http_message.62e06161.png"},500:function(v,_,t){v.exports=t.p+"assets/img/get.b191c876.png"},501:function(v,_,t){v.exports=t.p+"assets/img/request_line.36108959.png"},502:function(v,_,t){v.exports=t.p+"assets/img/status_line.a1477b90.png"},503:function(v,_,t){v.exports=t.p+"assets/img/request_head.1fe4c112.png"},504:function(v,_,t){v.exports=t.p+"assets/img/response_head.cb0d1d2c.png"},505:function(v,_,t){v.exports=t.p+"assets/img/server_github.f1970aae.png"}}]);